<nav id="main-nav" class="main-nav">
  <div class="nav-container">
    <section class="nav-brand">
      <a href="{{ site.BaseURL }}" class="nav-logo-link">
        <div class="nav-logo">
          <img src="{{ site.Params.logoLight | relURL }}" alt="{{ site.Params.headerTitle | default site.Title }}" class="nav-logo-light" />
          <img src="{{ site.Params.logoDark | relURL }}" alt="{{ site.Params.headerTitle | default site.Title }}" class="nav-logo-dark" />
        </div>
      </a>
      {{ if or site.Params.headerTitle site.Params.motto }}
      <div class="nav-text">
        {{ if site.Params.headerTitle }}
        <a href="{{ site.BaseURL }}" class="nav-title">
          {{ site.Params.headerTitle }}
        </a>
        {{ end }}
        {{ if site.Params.motto }}
        <div class="nav-motto">{{ site.Params.motto }}</div>
        {{ end }}
      </div>
      {{ end }}
    </section>

    <section class="nav-items">
      {{ $navItems := slice "search" "rss" }}
      {{ if site.Params.reorderNavItems }}
        {{ $navItems = site.Params.reorderNavItems }}
      {{ end }}
      {{ if not site.Params.collapseNavItems }}
      {{ range $navItems }}
      {{ partial "renderNavItem.html" . }}
      {{ end }}
      {{ with site.Params.navItems }}
      {{ partial "navCustomItems.html" (dict "navItems" $navItems "mobile" false) }}
      {{ end }}
      {{ else }}
      {{ $collapseNavItems := site.Params.collapseNavItems }}
      {{ $items := complement $collapseNavItems $navItems }}
      {{ range $items }}
      {{ partial "renderNavItem.html" . }}
      {{ end }}
      <div class="dropdown dropdown-end dropdown-hover">
        <div tabindex="0" role="button" class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option">
          <ion-icon class="group-hover:text-primary-content text-xl" name="menu"></ion-icon>
        </div>
        <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-xl">
          {{ range $collapseNavItems }}
          {{ partial "renderMobileNavItem.html" . }}
          {{ end }}
          {{ with site.Params.navItems }}
          {{ partial "navCustomItems.html" (dict "navItems" $navItems "mobile" true) }}
          {{ end }}
        </ul>
      </div>
      {{ end }}
    </section>
  </div>
</nav>

<script>
  // Scroll detection for nav background change
  (function() {
    const nav = document.getElementById('main-nav');
    const logo = document.getElementById('nav-logo-img');
    let lastScroll = 0;
    
    function handleScroll() {
      const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
      
      if (currentScroll > 50) {
        nav.classList.add('scrolled');
      } else {
        nav.classList.remove('scrolled');
      }
      
      lastScroll = currentScroll;
    }
    
    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll(); // Check initial state
  })();
</script>
